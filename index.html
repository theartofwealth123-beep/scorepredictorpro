<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ScorePredictor Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; background: #0f172a; color: white; margin:0; min-height:100vh; }
    .container { max-width: 1200px; margin: 0 auto; padding: 2rem; text-align: center; }
    h1 { font-size: 4.5rem; background: linear-gradient(to right, #60a5fa, #c084fc); -webkit-background-clip: text; color: transparent; }
    .btn { padding: 1rem 2.5rem; font-size: 1.5rem; margin: 1rem; border-radius: 1rem; cursor: pointer; font-weight: bold; }
    .btn-login { background: white; color: black; }
    .btn-logout { background: #ef4444; }
    .card { background: #1e293b; padding: 1.5rem; border-radius: 1rem; margin: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ScorePredictor Pro</h1>
    <p style="font-size:1.8rem; color:#94a3b8;">AI-powered edge on every game</p>

    <div id="auth">
      <button id="login" class="btn btn-login">Login / Sign Up</button>
      <div style="margin-top:1rem;">
        <label style="color:#94a3b8;">
          <input type="checkbox" id="remember" checked> Stay logged in
        </label>
      </div>
    </div>

    <div id="app" class="hidden">
      <h2>Welcome back, <span id="name" style="color:#60a5fa;"></span>!</h2>
      <p id="email" style="color:#94a3b8;"></p>
      <button id="logout" class="btn btn-logout">Logout</button>
      <h2 style="margin-top:3rem;">Today's Live Games</h2>
      <div id="games" class="grid"></div>
    </div>
  </div>

  <script>
    let auth0 = null;

    const initAuth0 = async () => {
      auth0 = await createAuth0Client({
        domain: "dev-3cwuyjrqj751y7nr.us.auth0.com",
        client_id: "R8YeJdb0ZGuXY0QLcO1FexwRmCrfpw1w",
        cacheLocation: "localstorage",
        useRefreshTokens: true
      });
    };

    document.getElementById("login").addEventListener("click", () => {
      const remember = document.getElementById("remember").checked;
      auth0.loginWithRedirect({
        redirect_uri: window.location.origin,
        prompt: remember ? undefined : "login"
      });
    });

    document.getElementById("logout").addEventListener("click", () => {
      auth0.logout({ returnTo: window.location.origin });
    });

    const loadGames = async () => {
      try {
        const res = await fetch("/.netlify/functions/today-games");
        if (!res.ok) throw new Error("Failed");
        const games = await res.json();
        const container = document.getElementById("games");
        container.innerHTML = games.slice(0, 9).map(g => 
          `<div class="card">
            <div style="font-size:0.9rem; color:#94a3b8;">${g.league}</div>
            <div style="font-size:1.8rem; font-weight:bold; margin:0.5rem 0;">${g.home}</div>
            <div style="font-size:2.5rem; color:#64748b;">VS</div>
            <div style="font-size:1.8rem; font-weight:bold;">${g.away}</div>
            <div style="margin-top:0.5rem; color:#60a5fa;">${g.time} â€¢ ${g.network || "TBD"}</div>
          </div>`
        ).join("");
      } catch (e) {
        document.getElementById("games").innerHTML = "<p style='color:#ef4444;'>Games failed to load (check function)</p>";
      }
    };

    window.addEventListener("load", async () => {
      await initAuth0();

      if (location.search.includes("code=")) {
        await auth0.handleRedirectCallback();
        window.history.replaceState({}, "", "/");
      }

      const isAuth = await auth0.isAuthenticated();
      if (isAuth) {
        const user = await auth0.getUser();
        document.getElementById("auth").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        document.getElementById("name").textContent = user.name || user.email.split("@")[0];
        document.getElementById("email").textContent = user.email;
        loadGames();
      }
    });
  </script>
</body>
</html>