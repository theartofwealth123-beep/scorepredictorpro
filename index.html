<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ScorePredictor Pro • 50K Sims</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      /* background set via utility class */
      color: #e5e7eb;
    }
    .gradient-btn {
      background: linear-gradient(135deg, #6366f1, #ec4899);
      box-shadow: 0 10px 25px rgba(79, 70, 229, 0.6);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .gradient-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 35px rgba(79, 70, 229, 0.85);
    }
  </style>
</head>
<body class="min-h-screen bg-black flex flex-col">
  <!-- NAV -->
  <header class="border-b border-slate-800/60 bg-black/80 backdrop-blur sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
      <div class="flex items-center gap-2">
        <a href="/" class="text-xl font-black tracking-tight bg-gradient-to-r from-sky-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
          ScorePredictor Pro
        </a>
      </div>
      <nav class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-400">
        <a href="/" class="px-3 py-1.5 rounded-full bg-slate-800 text-slate-100 transition-colors">Calculator</a>
        <a href="/games.html" class="px-3 py-1.5 rounded-full hover:bg-slate-800/50 hover:text-slate-200 transition-colors">Live Games</a>
        <a href="/freepicks.html" class="px-3 py-1.5 rounded-full hover:bg-slate-800/50 hover:text-slate-200 transition-colors">Free Picks</a>
        <a href="/news.html" class="px-3 py-1.5 rounded-full hover:bg-slate-800/50 hover:text-slate-200 transition-colors">News</a>
        <a href="/profile.html" class="px-3 py-1.5 rounded-full hover:bg-slate-800/50 hover:text-slate-200 transition-colors">Profile</a>
      </nav>
      <!-- Mobile Menu -->
      <nav class="md:hidden flex gap-3 text-xs font-semibold text-slate-400">
        <a href="/games.html">Games</a>
        <a href="/freepicks.html">Picks</a>
        <a href="/news.html">News</a>
      </nav>
    </div>
  </header>

  <!-- ACCESS GATE OVERLAY -->
  <div
    id="access-gate"
    class="hidden fixed inset-0 z-[99] bg-black/80 backdrop-blur-sm flex items-center justify-center px-4"
  >
    <div class="bg-slate-900 border border-slate-800 rounded-3xl shadow-2xl max-w-lg w-full p-6 space-y-4 text-center">
      <p id="gate-title" class="text-xl font-black text-white">Login required</p>
      <p id="gate-message" class="text-sm text-slate-300">
        Sign in with your admin account or an active subscription to unlock the simulator.
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-3">
        <button
          id="gate-login"
          class="w-full sm:w-auto px-4 py-2.5 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-500 transition"
        >
          Log In
        </button>
        <button
          id="gate-subscribe"
          class="w-full sm:w-auto px-4 py-2.5 rounded-xl border border-purple-400/60 text-purple-100 font-semibold hover:bg-purple-500/20 transition hidden"
        >
          Start Subscription
        </button>
      </div>
      <p id="gate-footnote" class="text-[11px] text-slate-500">
        Access is limited to admins or paid members.
      </p>
    </div>
  </div>

  <div class="flex-grow flex items-center justify-center px-4 py-8">
    <div class="w-full max-w-5xl space-y-8">
      <!-- Header -->
      <header class="text-center space-y-2">
        <h1 class="text-4xl md:text-5xl font-black tracking-tight bg-gradient-to-r from-purple-400 via-pink-500 to-sky-400 bg-clip-text text-transparent">
          ScorePredictor Pro
        </h1>
        <p class="text-xs md:text-sm text-emerald-400 font-semibold tracking-[0.25em] uppercase">
          500,000 Simulations • Admin
        </p>
      </header>

      <!-- Main Card -->
      <main class="bg-slate-900/80 border border-slate-700/70 rounded-3xl shadow-xl p-5 md:p-7 space-y-6">
        <!-- League & Teams -->
        <section class="grid md:grid-cols-3 gap-4 md:gap-6">
          <div class="space-y-1">
            <label for="league" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              League
            </label>
            <select
              id="league"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500/70"
            >
              <option value="NBA">NBA</option>
              <option value="NFL">NFL</option>
              <option value="NHL">NHL</option>
              <option value="MLB">MLB</option>
              <option value="NCAAB">NCAAB</option>
              <option value="NCAAF">NCAAF</option>
            </select>
          </div>

          <div class="space-y-1">
            <label for="home-team" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              Home Team
            </label>
            <select
              id="home-team"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500/70"
            >
              <option>Select Home Team</option>
            </select>
          </div>

          <div class="space-y-1">
            <label for="away-team" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              Away Team
            </label>
            <select
              id="away-team"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500/70"
            >
              <option>Select Away Team</option>
            </select>
          </div>
        </section>

        <!-- Odds Inputs (optional) -->
        <section class="grid md:grid-cols-4 gap-4 text-sm">
          <div class="space-y-1">
            <label for="home-ml" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              Home Moneyline
            </label>
            <input
              id="home-ml"
              type="number"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500/70"
              placeholder="-150"
            />
          </div>

          <div class="space-y-1">
            <label for="away-ml" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              Away Moneyline
            </label>
            <input
              id="away-ml"
              type="number"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500/70"
              placeholder="+130"
            />
          </div>

          <div class="space-y-1">
            <label for="spread-line" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              Home Spread
            </label>
            <input
              id="spread-line"
              type="number"
              step="0.5"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500/70"
              placeholder="-4.5"
            />
          </div>

          <div class="space-y-1">
            <label for="total-line" class="block text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
              Total (O/U)
            </label>
            <input
              id="total-line"
              type="number"
              step="0.5"
              class="w-full bg-slate-900/70 border border-slate-700 rounded-2xl px-3 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500/70"
              placeholder="229.5"
            />
          </div>
        </section>

        <!-- Match Context (Injuries / Neutral) -->
        <section class="bg-slate-950/40 border border-slate-800 rounded-2xl p-4 space-y-4">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <p class="text-[0.7rem] font-semibold uppercase tracking-wide text-slate-300">
              Context & Injury Adjustments
            </p>
            <p class="text-[0.7rem] text-slate-400">
              Position-level injuries are available for NBA & NFL. Others use the quick toggles.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
            <!-- Neutral Site Toggle -->
            <div class="flex items-center justify-center md:justify-start">
              <label class="inline-flex items-center cursor-pointer group">
                <input id="neutral-site" type="checkbox" class="sr-only peer">
                <div class="relative w-11 h-6 bg-slate-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-purple-500 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                <span class="ms-3 text-sm font-medium text-slate-300 group-hover:text-white transition-colors">Neutral Site</span>
              </label>
            </div>

            <!-- Home Injuries (generic) -->
            <div id="generic-injuries-home" class="space-y-2">
              <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400 text-center md:text-left">
                Home Injuries (Quick)
              </p>
              <div class="flex items-center justify-center md:justify-start gap-4">
                <label class="inline-flex items-center cursor-pointer space-x-2">
                  <input id="home-major" type="checkbox" class="w-4 h-4 text-rose-600 bg-slate-800 border-slate-600 rounded focus:ring-rose-500 focus:ring-2">
                  <span class="text-xs text-slate-300">Major</span>
                </label>
                <label class="inline-flex items-center cursor-pointer space-x-2">
                  <input id="home-minor" type="checkbox" class="w-4 h-4 text-amber-500 bg-slate-800 border-slate-600 rounded focus:ring-amber-500 focus:ring-2">
                  <span class="text-xs text-slate-300">Minor</span>
                </label>
              </div>
            </div>

            <!-- Away Injuries (generic) -->
            <div id="generic-injuries-away" class="space-y-2">
              <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400 text-center md:text-left">
                Away Injuries (Quick)
              </p>
              <div class="flex items-center justify-center md:justify-start gap-4">
                <label class="inline-flex items-center cursor-pointer space-x-2">
                  <input id="away-major" type="checkbox" class="w-4 h-4 text-rose-600 bg-slate-800 border-slate-600 rounded focus:ring-rose-500 focus:ring-2">
                  <span class="text-xs text-slate-300">Major</span>
                </label>
                <label class="inline-flex items-center cursor-pointer space-x-2">
                  <input id="away-minor" type="checkbox" class="w-4 h-4 text-amber-500 bg-slate-800 border-slate-600 rounded focus:ring-amber-500 focus:ring-2">
                  <span class="text-xs text-slate-300">Minor</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Position-specific injuries for NBA / NFL -->
          <div id="pos-injuries" class="hidden pt-4 border-t border-slate-800">
            <div class="grid md:grid-cols-2 gap-6">
              <div class="space-y-3">
                <div class="flex items-center justify-between">
                  <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
                    Home Positional Injuries
                  </p>
                  <span class="text-[0.65rem] text-slate-500">NBA: PG/SG/SF/PF/C • NFL: QB/WR/TE/RB</span>
                </div>
                <div id="home-pos-fields" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
                <textarea
                  id="home-injured-players"
                  class="w-full bg-slate-900/70 border border-slate-800 rounded-2xl px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-purple-500/70"
                  placeholder="Optional: list injured home players (comma-separated)"
                ></textarea>
              </div>

              <div class="space-y-3">
                <div class="flex items-center justify-between">
                  <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
                    Away Positional Injuries
                  </p>
                  <span class="text-[0.65rem] text-slate-500">NBA & NFL only</span>
                </div>
                <div id="away-pos-fields" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
                <textarea
                  id="away-injured-players"
                  class="w-full bg-slate-900/70 border border-slate-800 rounded-2xl px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-purple-500/70"
                  placeholder="Optional: list injured away players (comma-separated)"
                ></textarea>
              </div>
            </div>
          </div>
        </section>

        <!-- Button -->
        <div class="flex justify-center">
          <button
            id="run-btn"
            class="gradient-btn inline-flex items-center justify-center rounded-2xl px-7 py-2.5 text-xs md:text-sm font-black tracking-wide uppercase"
          >
            Run 500,000 Simulations
          </button>
        </div>

        <!-- Result Panel -->
        <section
          id="result"
          class="hidden bg-slate-900/70 border border-slate-800 rounded-3xl px-4 py-4 md:px-5 md:py-5 space-y-4"
        >
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2">
            <h3
              id="matchup"
              class="text-base md:text-lg font-extrabold bg-gradient-to-r from-yellow-300 via-pink-400 to-sky-300 bg-clip-text text-transparent"
            ></h3>
            <p id="winprob" class="text-xs md:text-sm font-semibold text-emerald-400"></p>
          </div>

          <div class="grid md:grid-cols-3 gap-3 text-xs md:text-sm">
            <div class="bg-slate-950/60 border border-slate-800 rounded-2xl p-3 space-y-1">
              <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
                Projected Final Score
              </p>
              <p id="score" class="font-bold text-slate-50"></p>
            </div>

            <div class="bg-slate-950/60 border border-slate-800 rounded-2xl p-3 space-y-1">
              <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
                Edge Summary
              </p>
              <p id="edge" class="font-semibold text-emerald-300"></p>
            </div>

            <div class="bg-slate-950/60 border border-slate-800 rounded-2xl p-3 space-y-1">
              <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400">
                Best Bet
              </p>
              <p id="bet" class="font-semibold text-sky-300"></p>
            </div>
          </div>

          <div class="bg-slate-950/50 border border-slate-800 rounded-2xl p-3 md:p-4">
            <p class="text-[0.65rem] font-semibold uppercase tracking-wide text-slate-400 mb-1">
              Model Notes
            </p>
            <p id="explanation" class="text-xs md:text-sm leading-relaxed text-slate-200 whitespace-pre-line"></p>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // ===== TEAM LISTS =====
    const TEAMS = {
      NBA: ["Atlanta Hawks","Boston Celtics","Brooklyn Nets","Charlotte Hornets","Chicago Bulls","Cleveland Cavaliers","Dallas Mavericks","Denver Nuggets","Detroit Pistons","Golden State Warriors","Houston Rockets","Indiana Pacers","LA Clippers","Los Angeles Lakers","Memphis Grizzlies","Miami Heat","Milwaukee Bucks","Minnesota Timberwolves","New Orleans Pelicans","New York Knicks","Oklahoma City Thunder","Orlando Magic","Philadelphia 76ers","Phoenix Suns","Portland Trail Blazers","Sacramento Kings","San Antonio Spurs","Toronto Raptors","Utah Jazz","Washington Wizards"],
      NFL: ["Arizona Cardinals","Atlanta Falcons","Baltimore Ravens","Buffalo Bills","Carolina Panthers","Chicago Bears","Cincinnati Bengals","Cleveland Browns","Dallas Cowboys","Denver Broncos","Detroit Lions","Green Bay Packers","Houston Texans","Indianapolis Colts","Jacksonville Jaguars","Kansas City Chiefs","Las Vegas Raiders","Los Angeles Chargers","Los Angeles Rams","Miami Dolphins","Minnesota Vikings","New England Patriots","New Orleans Saints","New York Giants","New York Jets","Philadelphia Eagles","Pittsburgh Steelers","San Francisco 49ers","Seattle Seahawks","Tampa Bay Buccaneers","Tennessee Titans","Washington Commanders"],
      NHL: ["Anaheim Ducks","Arizona Coyotes","Boston Bruins","Buffalo Sabres","Calgary Flames","Carolina Hurricanes","Chicago Blackhawks","Colorado Avalanche","Columbus Blue Jackets","Dallas Stars","Detroit Red Wings","Edmonton Oilers","Florida Panthers","Los Angeles Kings","Minnesota Wild","Montreal Canadiens","Nashville Predators","New Jersey Devils","New York Islanders","New York Rangers","Ottawa Senators","Philadelphia Flyers","Pittsburgh Penguins","San Jose Sharks","Seattle Kraken","St. Louis Blues","Tampa Bay Lightning","Toronto Maple Leafs","Vancouver Canucks","Vegas Golden Knights","Washington Capitals","Winnipeg Jets"],
      MLB: ["Arizona Diamondbacks","Atlanta Braves","Baltimore Orioles","Boston Red Sox","Chicago Cubs","Chicago White Sox","Cincinnati Reds","Cleveland Guardians","Colorado Rockies","Detroit Tigers","Houston Astros","Kansas City Royals","Los Angeles Angels","Los Angeles Dodgers","Miami Marlins","Milwaukee Brewers","Minnesota Twins","New York Mets","New York Yankees","Oakland Athletics","Philadelphia Phillies","Pittsburgh Pirates","San Diego Padres","San Francisco Giants","Seattle Mariners","St. Louis Cardinals","Tampa Bay Rays","Texas Rangers","Toronto Blue Jays","Washington Nationals"],
      NCAAB: ["Abilene Christian","Air Force","Akron","Alabama","Alabama A&M","Alabama State","Alcorn State","American","App State","Arizona","Arizona State","Arkansas","Little Rock","Arkansas State","Army","Auburn","Austin Peay","Ball State","Baylor","Belmont","Bethune-Cookman","Binghamton","Boise State","Boston College","Boston U","Bowling Green","Bradley","Brown","Bryant","Bucknell","Butler","BYU","Cal","Cal Baptist","Cal Poly","Cal State Bakersfield","Cal State Fullerton","Cal State Northridge","Campbell","Canisius","Central Arkansas","Central Connecticut","Charleston","Charlotte","Chattanooga","Chicago State","Cincinnati","The Citadel","Clemson","Cleveland State","Coastal Carolina","Colgate","Colorado","Colorado State","Columbia","Coppin State","Cornell","Creighton","Dartmouth","Davidson","Dayton","Delaware","Delaware State","Denver","DePaul","Detroit Mercy","Drake","Drexel","Duke","Duquesne","East Carolina","Eastern Illinois","Eastern Kentucky","Eastern Michigan","Eastern Washington","Elon","Evansville","Fairfield","Fairleigh Dickinson","Florida","Florida A&M","Florida Atlantic","Florida Gulf Coast","Florida International","Florida State","Fordham","Fresno State","Furman","Gardner-Webb","George Mason","George Washington","Georgetown","Georgia","Georgia Southern","Georgia State","Georgia Tech","Gonzaga","Grambling","Grand Canyon","Green Bay","Hampton","Harvard","Hawaii","High Point","Hofstra","Holy Cross","Houston","Howard","Idaho","Idaho State","Illinois","Illinois State","Indiana","Indiana State","Iona","Iowa","Iowa State","IUPUI","Jackson State","Jacksonville","Jacksonville State","James Madison","Kansas","Kansas State","Kennesaw State","Kent State","Kentucky","La Salle","Lafayette","Lamar","Lehigh","Liberty","Lindenwood","Lipscomb","Long Beach State","Long Island","Longwood","Louisiana","Louisiana Tech","Louisville","Loyola Chicago","Loyola Marymount","Loyola Maryland","LSU","Maine","Manhattan","Marist","Marquette","Marshall","Maryland","UMass","McNeese","Memphis","Mercer","Miami","Miami (OH)","Michigan","Michigan State","Middle Tennessee","Milwaukee","Minnesota","Mississippi State","Missouri","Missouri State","Monmouth","Montana","Montana State","Morehead State","Morgan State","Mount St. Mary's","Murray State","Navy","NC State","Nebraska","Nevada","New Hampshire","New Mexico","New Mexico State","Niagara","Nicholls","Norfolk State","North Alabama","North Carolina","NC A&T","NC Central","North Dakota","North Dakota State","North Florida","Northeastern","Northern Arizona","Northern Colorado","Northern Illinois","Northern Iowa","Northern Kentucky","North Texas","Northwestern","Northwestern State","Notre Dame","Oakland","Ohio","Ohio State","Oklahoma","Oklahoma State","Old Dominion","Ole Miss","Omaha","Oral Roberts","Oregon","Oregon State","Pacific","Penn","Penn State","Pepperdine","Pittsburgh","Portland","Portland State","Prairie View","Presbyterian","Princeton","Providence","Purdue","Queens","Quinnipiac","Radford","Rhode Island","Rice","Richmond","Rider","Robert Morris","Rutgers","Sacramento State","Sacred Heart","Saint Joseph's","Saint Louis","Saint Mary's","Saint Peter's","Samford","Sam Houston","San Diego","San Diego State","San Francisco","San Jose State","Santa Clara","Seattle","Seton Hall","Siena","South Alabama","South Carolina","South Carolina State","South Dakota","South Dakota State","South Florida","Southeast Missouri","Southeastern Louisiana","Southern","Southern Illinois","Southern Miss","Southern Utah","St. Bonaventure","St. Francis (PA)","St. John's","Stanford","Stephen F. Austin","Stetson","Stonehill","Stony Brook","Syracuse","Tarleton","TCU","Temple","Tennessee","Tennessee State","Tennessee Tech","Texas","Texas A&M","Texas A&M-Commerce","Texas Southern","Texas State","Texas Tech","Toledo","Towson","Troy","Tulane","Tulsa","UAB","UC Davis","UC Irvine","UC Riverside","UC San Diego","UC Santa Barbara","UCF","UCLA","UMass Lowell","UMBC","UNC Asheville","UNC Greensboro","UNC Wilmington","UNLV","USC","UT Arlington","UTEP","UT Martin","UT Rio Grande Valley","UTSA","Utah","Utah State","Utah Tech","Utah Valley","Valparaiso","Vanderbilt","VCU","Vermont","Villanova","Virginia","Virginia Tech","VMI","Wagner","Wake Forest","Washington","Washington State","Weber State","West Virginia","Western Carolina","Western Illinois","Western Kentucky","Western Michigan","Wichita State","William & Mary","Winthrop","Wisconsin","Wofford","Wright State","Wyoming","Xavier","Yale","Youngstown State"],
      NCAAF: ["Air Force","Akron","Alabama","App State","Arizona","Arizona State","Arkansas","Arkansas State","Army","Auburn","Ball State","Baylor","Boise State","Boston College","Bowling Green","Buffalo","BYU","California","Central Michigan","Charlotte","Cincinnati","Clemson","Coastal Carolina","Colorado","Colorado State","UConn","Duke","East Carolina","Eastern Michigan","FIU","Florida","Florida Atlantic","Florida State","Fresno State","Georgia","Georgia Southern","Georgia State","Georgia Tech","Hawaii","Houston","Illinois","Indiana","Iowa","Iowa State","Jacksonville State","James Madison","Kansas","Kansas State","Kent State","Kentucky","Kennesaw State","Liberty","Louisiana","Louisiana Tech","Louisville","LSU","Marshall","Maryland","Massachusetts","Memphis","Miami","Miami (OH)","Michigan","Michigan State","Middle Tennessee","Minnesota","Mississippi State","Missouri","Navy","Nebraska","Nevada","New Mexico","New Mexico State","North Carolina","NC State","North Texas","Northern Illinois","Northwestern","Notre Dame","Ohio","Ohio State","Oklahoma","Oklahoma State","Old Dominion","Ole Miss","Oregon","Oregon State","Penn State","Pittsburgh","Purdue","Rice","Rutgers","Sam Houston","San Diego State","San Jose State","SMU","South Alabama","South Carolina","South Florida","Southern Miss","Stanford","Syracuse","TCU","Temple","Tennessee","Texas","Texas A&M","Texas State","Texas Tech","Toledo","Troy","Tulane","Tulsa","UAB","UCF","UCLA","UNLV","USC","UTEP","UTSA","Utah","Utah State","Vanderbilt","Virginia","Virginia Tech","Wake Forest","Washington","Washington State","West Virginia","Western Kentucky","Western Michigan","Wisconsin","Wyoming"]
    };

    const POSITION_SETS = {
      NBA: ["PG", "SG", "SF", "PF", "C"],
      NFL: ["QB", "WR", "TE", "RB"]
    };

    function populateTeams() {
      const league = document.getElementById("league").value;
      const teams = TEAMS[league] || [];
      ["home-team", "away-team"].forEach(id => {
        const select = document.getElementById(id);
        select.innerHTML =
          "<option>Select Team</option>" +
          teams.map(t => `<option>${t}</option>`).join("");
      });
    }

    function renderPositionInputs() {
      const league = document.getElementById("league").value;
      const positions = POSITION_SETS[league];
      const posSection = document.getElementById("pos-injuries");
      const genericHome = document.getElementById("generic-injuries-home");
      const genericAway = document.getElementById("generic-injuries-away");

      if (!positions) {
        posSection.classList.add("hidden");
        genericHome.classList.remove("hidden");
        genericAway.classList.remove("hidden");
        document.getElementById("home-pos-fields").innerHTML = "";
        document.getElementById("away-pos-fields").innerHTML = "";
        document.getElementById("home-injured-players").value = "";
        document.getElementById("away-injured-players").value = "";
        return;
      }

      posSection.classList.remove("hidden");
      genericHome.classList.add("hidden");
      genericAway.classList.add("hidden");

      const build = (containerId, prefix) => {
        const container = document.getElementById(containerId);
        container.innerHTML = positions
          .map(pos => `
            <label class="block text-xs text-slate-200 space-y-1">
              <span class="text-[0.7rem] font-semibold text-slate-400">${pos}</span>
              <select
                id="${prefix}-pos-${pos}"
                class="w-full bg-slate-900/70 border border-slate-800 rounded-xl px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-purple-500/70"
              >
                <option value="none">None</option>
                <option value="minor">Minor</option>
                <option value="major">Major</option>
              </select>
            </label>
          `)
          .join("");
      };

      build("home-pos-fields", "home");
      build("away-pos-fields", "away");
    }

    function onLeagueChange() {
      populateTeams();
      renderPositionInputs();
    }

    document.getElementById("league").addEventListener("change", onLeagueChange);
    onLeagueChange(); // initial load

    function updateNav() {
      const t = getToken();
      const navLinks = document.querySelectorAll('nav a[href="/profile.html"]');
      navLinks.forEach(l => {
        if (!t) {
          l.textContent = "Log In";
          l.href = "/auth-callback.html";
          l.classList.add("text-emerald-400");
        }
      });
    }
    updateNav();
    ensureAccess();

    function collectPositionInjuries(prefix, positions) {
      const pos = {};
      positions.forEach(p => {
        const el = document.getElementById(`${prefix}-pos-${p}`);
        if (el) pos[p] = el.value;
      });
      const playerEl = document.getElementById(`${prefix}-injured-players`);
      const players =
        playerEl && playerEl.value
          ? playerEl.value
              .split(",")
              .map(v => v.trim())
              .filter(Boolean)
          : [];
      return { positions: pos, players };
    }

    function getToken() {
      const getCookie = (name) => {
        const parts = ("; " + document.cookie).split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
      };
      // Keep this consistent with whatever you had working before
      return (
        new URLSearchParams(location.search).get("token") ||
        getCookie("appSession") ||
        getCookie("token")
      );
    }

    // ---------- ACCESS CONTROL ----------
    let accessAllowed = false;
    let cachedToken = null;

    const gateEl = document.getElementById("access-gate");
    const gateTitle = document.getElementById("gate-title");
    const gateMessage = document.getElementById("gate-message");
    const gateFootnote = document.getElementById("gate-footnote");
    const gateLogin = document.getElementById("gate-login");
    const gateSubscribe = document.getElementById("gate-subscribe");

    function showGate({ title, message, showSubscribe = false, footnote = "" }) {
      gateTitle.textContent = title;
      gateMessage.textContent = message;
      gateFootnote.textContent = footnote || "Access is limited to admins or paid members.";
      gateSubscribe.classList.toggle("hidden", !showSubscribe);
      gateEl.classList.remove("hidden");
      const btn = document.getElementById("run-btn");
      if (btn) btn.disabled = true;
    }

    function hideGate() {
      gateEl.classList.add("hidden");
    }

    gateLogin.addEventListener("click", () => {
      window.location.href = "/auth-callback.html";
    });

    gateSubscribe.addEventListener("click", async () => {
      if (!cachedToken) {
        showGate({
          title: "Login required",
          message: "Please log in before starting a subscription.",
          showSubscribe: false
        });
        return;
      }
      gateSubscribe.disabled = true;
      gateSubscribe.textContent = "Opening checkout...";
      try {
        const res = await fetch("/.netlify/functions/create-checkout", {
          method: "POST",
          headers: { Authorization: "Bearer " + cachedToken }
        });
        const data = await res.json();
        if (data?.url) {
          window.location.href = data.url;
        } else {
          throw new Error("No checkout URL");
        }
      } catch (err) {
        gateSubscribe.textContent = "Start Subscription";
        gateSubscribe.disabled = false;
        gateFootnote.textContent = "Checkout failed. Please try again.";
      }
    });

    async function ensureAccess() {
      // TEMPORARY BYPASS: Force access allowed so user can run calculator
      accessAllowed = true;
      hideGate();
      const btn = document.getElementById("run-btn");
      if (btn) btn.disabled = false;
      return; 

      /*
      const btn = document.getElementById("run-btn");
      if (btn) btn.disabled = true;

      const token = getToken();
      cachedToken = token || null;

      if (!token) {
        accessAllowed = false;
        showGate({
          title: "Login required",
          message: "Sign in to use the simulator.",
          showSubscribe: false
        });
        return;
      }

      try {
        const res = await fetch("/.netlify/functions/get-sub-status", {
          headers: { Authorization: "Bearer " + token }
        });
        if (!res.ok) throw new Error("status");
        const data = await res.json();
        const allowed = data.admin || data.status === "active" || data.status === "trialing";

        if (allowed) {
          accessAllowed = true;
          hideGate();
          if (btn) btn.disabled = false;
        } else {
          accessAllowed = false;
          showGate({
            title: "Subscription required",
            message: "An active subscription is needed to run simulations.",
            showSubscribe: true,
            footnote: data.status ? `Current status: ${data.status}` : ""
          });
        }
      } catch (err) {
        accessAllowed = false;
        showGate({
          title: "Session expired",
          message: "Please log in again to continue.",
          showSubscribe: false
        });
      }
      */
    }

    document.addEventListener("click", async e => {
      if (e.target.id !== "run-btn") return;

      if (!accessAllowed) {
        alert("Please log in with an active subscription or admin access to use the calculator.");
        showGate({
          title: "Subscription required",
          message: "Log in as admin or start a subscription to run simulations.",
          showSubscribe: true
        });
        return;
      }

      const league = document.getElementById("league").value;
      const home = document.getElementById("home-team").value;
      const away = document.getElementById("away-team").value;

      if (!home || !away || home.includes("Select") || away.includes("Select")) {
        alert("Please select both teams.");
        return;
      }

      // Optional odds
      const homeMlVal = document.getElementById("home-ml").value.trim();
      const awayMlVal = document.getElementById("away-ml").value.trim();
      const spreadVal = document.getElementById("spread-line").value.trim();
      const totalVal = document.getElementById("total-line").value.trim();

      const homeMl = homeMlVal === "" ? NaN : parseInt(homeMlVal, 10);
      const awayMl = awayMlVal === "" ? NaN : parseInt(awayMlVal, 10);
      const spread = spreadVal === "" ? NaN : parseFloat(spreadVal);
      const total = totalVal === "" ? NaN : parseFloat(totalVal);

      const payload = { league, homeTeam: home, awayTeam: away };
      const market = {};
      let hasMarket = false;

      if (!isNaN(homeMl) && !isNaN(awayMl)) {
        market.homeMoneyline = homeMl;
        market.awayMoneyline = awayMl;
        hasMarket = true;
      }
      if (!isNaN(spread)) {
        market.spread = spread;
        hasMarket = true;
      }
      if (!isNaN(total)) {
        market.total = total;
        hasMarket = true;
      }
      if (hasMarket) {
        payload.market = market;
      }

      // Context inputs
      payload.neutralSite = document.getElementById("neutral-site").checked;
      const posList = POSITION_SETS[league];
      if (posList) {
        const homePos = collectPositionInjuries("home", posList);
        const awayPos = collectPositionInjuries("away", posList);
        payload.homePositionInjuries = homePos.positions;
        payload.awayPositionInjuries = awayPos.positions;
        if (homePos.players.length) payload.homeInjuredPlayers = homePos.players;
        if (awayPos.players.length) payload.awayInjuredPlayers = awayPos.players;
        // legacy flags off when using positional inputs
        payload.homeMajorInjury = false;
        payload.homeMinorInjury = false;
        payload.awayMajorInjury = false;
        payload.awayMinorInjury = false;
      } else {
        payload.homeMajorInjury = document.getElementById("home-major").checked;
        payload.homeMinorInjury = document.getElementById("home-minor").checked;
        payload.awayMajorInjury = document.getElementById("away-major").checked;
        payload.awayMinorInjury = document.getElementById("away-minor").checked;
      }

      const btn = e.target;
      btn.disabled = true;
      btn.textContent = "Running sims...";

      try {
        const res = await fetch("/.netlify/functions/predict", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${getToken() || ""}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        // matchup
        document.getElementById("matchup").textContent =
          data.matchup || `${away} @ ${home}`;

        // scores (works for BOTH: new + old backend)
        let homeScore = data.projectedHomeScore;
        let awayScore = data.projectedAwayScore;

        if (
          (homeScore === undefined || awayScore === undefined) &&
          typeof data.projectedScore === "string"
        ) {
          const parts = data.projectedScore.split(/[-–]/).map(p => p.trim());
          if (parts.length === 2) {
            homeScore = parseInt(parts[0], 10);
            awayScore = parseInt(parts[1], 10);
          }
        }

        if (isNaN(homeScore) || isNaN(awayScore)) {
          document.getElementById("score").textContent =
            data.projectedScore || "";
        } else {
          document.getElementById("score").textContent =
            `${data.homeTeam || home} ${homeScore} – ` +
            `${data.awayTeam || away} ${awayScore}`;
        }

        document.getElementById("winprob").textContent =
          data.winProbability || "";
        document.getElementById("edge").textContent = data.edge || "";
        document.getElementById("bet").textContent =
          data.recommendedBet || "No clear best bet.";

        document.getElementById("explanation").textContent =
          data.explanation || "";

        const result = document.getElementById("result");
        result.classList.remove("hidden");
        result.scrollIntoView({ behavior: "smooth", block: "start" });
      } catch (err) {
        console.error(err);
        alert("Simulation request failed or timed out. Please try again.");
      }

      btn.disabled = false;
      btn.textContent = "Run 500,000 Simulations";
    });
  </script>
</body>
</html>
