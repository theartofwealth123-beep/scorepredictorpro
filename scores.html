<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ScorePredictor Pro • Today’s Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #020617; color: #e5e7eb; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .glass {
      background: radial-gradient(circle at top left, rgba(96,165,250,0.12), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(244,114,182,0.12), transparent 55%);
    }
  </style>
</head>
<body class="min-h-screen glass">
  <!-- NAV -->
  <header class="border-b border-slate-800/60 bg-black/60 backdrop-blur">
    <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
      <div class="flex items-center gap-2">
        <span class="text-xl font-black tracking-tight bg-gradient-to-r from-sky-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
          ScorePredictor Pro
        </span>
        <span class="px-2 py-0.5 text-[0.65rem] rounded-full border border-emerald-400/40 text-emerald-300/90 font-semibold ml-1">
          LIVE BOARD
        </span>
      </div>
      <nav class="flex items-center gap-3 text-sm">
        <a href="/scores.html" class="px-3 py-1 rounded-full bg-slate-800 text-slate-100 font-medium">Scores</a>
        <a href="/" class="px-3 py-1 rounded-full hover:bg-slate-800/70 text-slate-300">Edge Calculator</a>
        <a href="/profile.html" class="px-3 py-1 rounded-full hover:bg-slate-800/70 text-slate-300">Profile</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <section class="mb-6 flex items-center justify-between gap-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-black tracking-tight">
          Today’s Games & Live Board
        </h1>
        <p class="text-slate-400 text-sm md:text-base mt-1">
          All major leagues in one place — NBA, NFL, NHL, MLB, NCAAF, NCAAB.
        </p>
      </div>
      <div class="text-right">
        <p class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">
          Edges Preview
        </p>
        <a href="/" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-xs font-semibold shadow-lg shadow-purple-500/40">
          Open Edge Calculator
        </a>
      </div>
    </section>

    <!-- Edge picks -->
    <section class="mb-10">
      <h2 class="text-sm font-semibold text-slate-300 tracking-[0.18em] uppercase mb-3">
        Top 5 Model Edges (Info Only)
      </h2>
      <div id="edges" class="grid gap-3 md:grid-cols-2"></div>
      <p id="edges-empty" class="text-sm text-slate-500 mt-1 hidden">
        No edges available right now. Check back closer to game times.
      </p>
    </section>

    <!-- Games grid -->
    <section>
      <h2 class="text-sm font-semibold text-slate-300 tracking-[0.18em] uppercase mb-3">
        Full Board
      </h2>
      <div id="games" class="grid gap-3 md:grid-cols-2 lg:grid-cols-3"></div>
      <p id="games-empty" class="text-sm text-slate-500 mt-1 hidden">
        No games found for today. It might be an off day or the feeds haven’t updated yet.
      </p>
    </section>
  </main>

  <script>
    async function loadGames() {
      const gamesEl = document.getElementById('games');
      const emptyEl = document.getElementById('games-empty');

      gamesEl.innerHTML = '<div class="col-span-full text-sm text-slate-400">Loading today\'s board…</div>';

      try {
        const res = await fetch('/.netlify/functions/today-games');
        const games = await res.json();

        if (!Array.isArray(games) || games.length === 0) {
          gamesEl.innerHTML = '';
          emptyEl.classList.remove('hidden');
          return;
        }

        emptyEl.classList.add('hidden');

        const leagueOrder = ['NBA', 'NCAAB', 'NFL', 'NCAAF', 'MLB', 'NHL'];
        games.sort((a, b) => {
          const li = leagueOrder.indexOf(a.league);
          const lj = leagueOrder.indexOf(b.league);
          if (li === lj) return a.time.localeCompare(b.time);
          if (li === -1 && lj === -1) return a.league.localeCompare(b.league);
          if (li === -1) return 1;
          if (lj === -1) return -1;
          return li - lj;
        });

        gamesEl.innerHTML = games.map(g => {
          const live = g.status && g.status !== 'STATUS_SCHEDULED';
          return `
            <article class="rounded-2xl border border-slate-800/80 bg-slate-950/60 p-3 text-xs md:text-sm flex flex-col gap-2">
              <div class="flex items-center justify-between gap-2">
                <span class="px-2 py-0.5 rounded-full border border-slate-700/80 text-[0.65rem] tracking-[0.16em] uppercase text-slate-300">
                  ${g.league}
                </span>
                <span class="text-[0.7rem] ${live ? 'text-emerald-400' : 'text-slate-400'} font-semibold">
                  ${live ? 'LIVE / IN-GAME' : 'SCHEDULED'}
                </span>
              </div>
              <div class="font-semibold">
                <div>${g.away}</div>
                <div class="text-slate-400 text-[0.75rem]">at</div>
                <div>${g.home}</div>
              </div>
              <div class="flex items-center justify-between text-[0.7rem] text-slate-400">
                <span>${g.time}</span>
                <span>${g.network}</span>
              </div>
            </article>
          `;
        }).join('');
      } catch (err) {
        console.error('today-games error', err);
        gamesEl.innerHTML = '<div class="col-span-full text-sm text-red-400">Failed to load games.</div>';
      }
    }

    async function loadEdges() {
      const edgesEl = document.getElementById('edges');
      const emptyEl = document.getElementById('edges-empty');

      edgesEl.innerHTML = '<div class="col-span-full text-sm text-slate-400">Scanning for edges…</div>';

      try {
        const res = await fetch('/.netlify/functions/today-edges');
        const edges = await res.json();

        if (!Array.isArray(edges) || edges.length === 0) {
          edgesEl.innerHTML = '';
          emptyEl.classList.remove('hidden');
          return;
        }

        emptyEl.classList.add('hidden');

        edgesEl.innerHTML = edges.map(e => `
          <article class="rounded-2xl border border-emerald-500/40 bg-emerald-950/40 px-4 py-3 text-xs md:text-sm">
            <div class="flex items-center justify-between gap-2 mb-1.5">
              <div class="flex items-center gap-2">
                <span class="px-2 py-0.5 rounded-full border border-emerald-500/60 text-[0.65rem] tracking-[0.16em] uppercase text-emerald-300">
                  ${e.league}
                </span>
                <span class="text-[0.7rem] text-emerald-200 font-semibold">
                  Model Edge
                </span>
              </div>
              <span class="text-[0.8rem] font-bold ${e.edgePct > 0 ? 'text-emerald-300' : 'text-slate-300'}">
                ${e.edgePct.toFixed(2)}%
              </span>
            </div>
            <div class="font-semibold mb-1">
              ${e.awayTeam} @ ${e.homeTeam}
            </div>
            <div class="text-[0.75rem] text-slate-300 mb-1">
              Projected: ${e.awayTeam} ${e.projectedAwayScore} – ${e.homeTeam} ${e.projectedHomeScore}
            </div>
            <div class="text-[0.7rem] text-slate-400 mb-1">
              Home win prob: ${e.homeWinProbability}
            </div>
            <div class="text-[0.7rem] text-slate-200">
              ${e.recommendedBet}
            </div>
          </article>
        `).join('');
      } catch (err) {
        console.error('today-edges error', err);
        edgesEl.innerHTML = '<div class="col-span-full text-sm text-red-400">Failed to load edges.</div>';
      }
    }

    loadGames();
    loadEdges();
  </script>
</body>
</html>
